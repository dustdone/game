<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åè®®æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .info-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .protocol {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
        }
        .http { color: #007acc; }
        .https { color: #28a745; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #005a9e;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ åè®®æµ‹è¯•é¡µé¢</h1>
    
    <div class="info-box">
        <h2>å½“å‰é¡µé¢ä¿¡æ¯</h2>
        <div class="protocol" id="currentProtocol"></div>
        <p><strong>URL:</strong> <span id="currentUrl"></span></p>
        <p><strong>åè®®:</strong> <span id="protocolType"></span></p>
        <p><strong>ä¸»æœº:</strong> <span id="currentHost"></span></p>
        <p><strong>ç«¯å£:</strong> <span id="currentPort"></span></p>
    </div>

    <div class="info-box">
        <h2>åè®®æµ‹è¯•</h2>
        <button onclick="testHttp()">æµ‹è¯•HTTPè®¿é—®</button>
        <button onclick="testHttps()">æµ‹è¯•HTTPSè®¿é—®</button>
        <button onclick="testLocalhost()">æµ‹è¯•Localhost</button>
        <button onclick="testLocalIP()">æµ‹è¯•å±€åŸŸç½‘IP</button>
        <div id="testResults"></div>
    </div>

    <div class="info-box">
        <h2>è„šæœ¬åŠ è½½æµ‹è¯•</h2>
        <button onclick="loadAuthScript()">åŠ è½½auth.js</button>
        <button onclick="loadGameScript()">åŠ è½½game.js</button>
        <div id="scriptResults"></div>
    </div>

    <div class="info-box">
        <h2>ç½‘ç»œçŠ¶æ€</h2>
        <p><strong>åœ¨çº¿çŠ¶æ€:</strong> <span id="onlineStatus"></span></p>
        <p><strong>è¿æ¥ç±»å‹:</strong> <span id="connectionType"></span></p>
        <p><strong>æœ‰æ•ˆç±»å‹:</strong> <span id="effectiveType"></span></p>
    </div>

    <script>
        // æ˜¾ç¤ºå½“å‰é¡µé¢ä¿¡æ¯
        function showPageInfo() {
            const protocol = window.location.protocol;
            const url = window.location.href;
            const host = window.location.hostname;
            const port = window.location.port || (protocol === 'https:' ? '443' : '80');
            
            document.getElementById('currentProtocol').textContent = `å½“å‰åè®®: ${protocol}`;
            document.getElementById('currentProtocol').className = `protocol ${protocol === 'https:' ? 'https' : 'http'}`;
            document.getElementById('currentUrl').textContent = url;
            document.getElementById('protocolType').textContent = protocol;
            document.getElementById('currentHost').textContent = host;
            document.getElementById('currentPort').textContent = port;
        }

        // æµ‹è¯•HTTPè®¿é—®
        async function testHttp() {
            const resultDiv = document.getElementById('testResults');
            try {
                const response = await fetch('/health');
                const data = await response.json();
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        âœ… HTTPè®¿é—®æˆåŠŸ<br>
                        æœåŠ¡å™¨: ${data.server.localURL}<br>
                        çŠ¶æ€: ${data.message}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        âŒ HTTPè®¿é—®å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }

        // æµ‹è¯•HTTPSè®¿é—®
        async function testHttps() {
            const resultDiv = document.getElementById('testResults');
            try {
                const httpsUrl = window.location.href.replace('http:', 'https:');
                const response = await fetch(httpsUrl);
                resultDiv.innerHTML = `
                    <div class="test-result warning">
                        âš ï¸ HTTPSè®¿é—®æˆåŠŸï¼Œä½†åº”è¯¥è¢«é‡å®šå‘åˆ°HTTP
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        âœ… HTTPSè®¿é—®è¢«æ­£ç¡®é˜»æ­¢: ${error.message}
                    </div>
                `;
            }
        }

        // æµ‹è¯•Localhost
        async function testLocalhost() {
            const resultDiv = document.getElementById('testResults');
            try {
                const response = await fetch('http://localhost:5555/health');
                const data = await response.json();
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        âœ… Localhostè®¿é—®æˆåŠŸ<br>
                        æœåŠ¡å™¨: ${data.server.localURL}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        âŒ Localhostè®¿é—®å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }

        // æµ‹è¯•å±€åŸŸç½‘IP
        async function testLocalIP() {
            const resultDiv = document.getElementById('testResults');
            try {
                const response = await fetch('/health');
                const data = await response.json();
                const localIP = data.server.localIP;
                
                if (localIP && localIP !== '127.0.0.1') {
                    const localResponse = await fetch(`http://${localIP}:5555/health`);
                    const localData = await localResponse.json();
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            âœ… å±€åŸŸç½‘IPè®¿é—®æˆåŠŸ<br>
                            IP: ${localIP}<br>
                            URL: ${localData.server.localNetworkURL}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-result warning">
                            âš ï¸ æ— æ³•è·å–å±€åŸŸç½‘IP
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        âŒ å±€åŸŸç½‘IPè®¿é—®å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }

        // åŠ è½½auth.jsè„šæœ¬
        function loadAuthScript() {
            const resultDiv = document.getElementById('scriptResults');
            try {
                const script = document.createElement('script');
                script.src = '/auth.js';
                script.onload = () => {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            âœ… auth.jsåŠ è½½æˆåŠŸ
                        </div>
                    `;
                };
                script.onerror = () => {
                    resultDiv.innerHTML = `
                        <div class="test-result error">
                            âŒ auth.jsåŠ è½½å¤±è´¥
                        </div>
                    `;
                };
                document.head.appendChild(script);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        âŒ è„šæœ¬åŠ è½½é”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        // åŠ è½½game.jsè„šæœ¬
        function loadGameScript() {
            const resultDiv = document.getElementById('scriptResults');
            try {
                const script = document.createElement('script');
                script.src = '/game.js';
                script.onload = () => {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            âœ… game.jsåŠ è½½æˆåŠŸ
                        </div>
                    `;
                };
                script.onerror = () => {
                    resultDiv.innerHTML = `
                        <div class="test-result error">
                            âŒ game.jsåŠ è½½å¤±è´¥
                        </div>
                    `;
                };
                document.head.appendChild(script);
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        âŒ è„šæœ¬åŠ è½½é”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºç½‘ç»œçŠ¶æ€
        function showNetworkStatus() {
            document.getElementById('onlineStatus').textContent = navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿';
            
            if ('connection' in navigator) {
                document.getElementById('connectionType').textContent = navigator.connection.effectiveType || 'æœªçŸ¥';
                document.getElementById('effectiveType').textContent = navigator.connection.effectiveType || 'æœªçŸ¥';
            } else {
                document.getElementById('connectionType').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('effectiveType').textContent = 'ä¸æ”¯æŒ';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            showPageInfo();
            showNetworkStatus();
            
            // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
            window.addEventListener('online', showNetworkStatus);
            window.addEventListener('offline', showNetworkStatus);
        });
    </script>
</body>
</html> 